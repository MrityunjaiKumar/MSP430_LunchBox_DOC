

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Experiments manual as per NPTEL series &mdash; MSP430 LunchBox 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Getting Started" href="../Get_Started/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> MSP430 LunchBox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Details/index.html">LunchBox Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Get_Started/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Experiments manual as per NPTEL series</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-you-need">What You Need</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-of-experiments">List of Experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#experiment-1-lunchbox-hello-led">Experiment 1 - LunchBox Hello LED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-needed">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connections">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-2-lunchbox-hello-blink-using-msp430-h">Experiment 2 - LunchBox Hello Blink (using MSP430.h)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#course-link">Course link</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schematic-image">Schematic image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-2-lunchbox-hello-blink-using-pointers">Experiment 2 - LunchBox Hello Blink (using pointers)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">Course link</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">Schematic image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-3-lunchbox-hello-switch">Experiment 3 - LunchBox Hello Switch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id13">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-4-lunchbox-debouncing-the-switch">Experiment 4 - LunchBox Debouncing the Switch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id18">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id19">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id20">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id21">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-5-lunchbox-hello-switch-pull-down">Experiment 5 - LunchBox Hello Switch Pull Down</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id23">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id26">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id27">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-6-lunchbox-helloswitch-pull-up">Experiment 6 - LunchBox HelloSwitch Pull Up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id28">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id29">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id31">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id32">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-7-lunchbox-helloclock">Experiment 7 - LunchBox HelloClock</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id33">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id34">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id35">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id36">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id37">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-8-lunchbox-helloresetsource">Experiment 8 - LunchBox HelloResetSource</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id38">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id39">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id40">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id41">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id42">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-9-lunchbox-hellointerrupt">Experiment 9 - LunchBox HelloInterrupt</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id43">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id44">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id45">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id46">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id47">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-10-lunchbox-hellointerrupt-rising">Experiment 10 - LunchBox HelloInterrupt Rising</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id48">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id49">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id50">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id51">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id52">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-11-lunchbox-hello-interrupt-on-falling-edge">Experiment 11 - LunchBox Hello Interrupt on Falling Edge</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id53">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id54">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id55">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id56">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id57">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-12-lunchbox-hello-seven-segment-display">Experiment 12 - LunchBox Hello Seven Segment Display</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id58">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id59">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id60">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id61">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id62">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-13-lunchbox-hello-low-power-mode-lpm">Experiment 13 - LunchBox Hello Low Power Mode (LPM)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id63">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id64">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id65">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id66">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id67">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-14-lunchbox-hellolcd">Experiment 14 - LunchBox HelloLCD</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id68">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id69">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id70">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id71">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id72">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-15-lunchbox-hello-lcd-with-custom-character">Experiment 15 - LunchBox Hello LCD With Custom Character</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id73">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id74">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id75">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id76">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id77">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-16-lunchbox-hello-timer">Experiment 16 - LunchBox Hello Timer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id78">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id79">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id80">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id81">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id82">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-17-lunchbox-hellosoftwarepwm-large-delay">Experiment 17 -LunchBox HelloSoftwarePWM (Large Delay)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id83">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id84">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id85">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id86">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id87">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-18-lunchbox-hello-hardware-pwm-8bit">Experiment 18 - LunchBox Hello Hardware PWM (8Bit)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id88">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id89">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id90">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id91">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id92">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-19-lunchbox-hello-hardware-pwm-16-bit">Experiment 19 - LunchBox Hello Hardware PWM (16 bit)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id93">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id94">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id95">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id96">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id97">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-20-lunchbox-hello-adc">Experiment 20 - LunchBox Hello ADC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id98">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id99">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id100">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id101">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id102">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-21-lunchbox-hello-adc-lcd">Experiment 21 - LunchBox Hello ADC LCD</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id103">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id104">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id105">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id106">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id107">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-22-lunchbox-hello-adc-internal-temperature-sensor">Experiment 22 - LunchBox Hello ADC Internal Temperature Sensor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id108">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id109">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id110">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id111">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id112">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-23-lunchbox-hello-lfsr-8bit">Experiment 23 - LunchBox Hello LFSR 8Bit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id113">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id114">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id115">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id116">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id117">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-24-lunchbox-hello-lfsr-32bit">Experiment 24 - LunchBox Hello LFSR 32Bit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id118">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id119">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id120">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id121">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id122">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-25-lunchbox-hello-dac">Experiment 25 - LunchBox Hello DAC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id123">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id124">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id125">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id126">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id127">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-26-lunchbox-lemon-battery-led-blink">Experiment 26  LunchBox Lemon Battery LED Blink</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id128">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id129">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id130">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id131">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id132">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-27-lunchbox-hello-serial">Experiment 27 - LunchBox Hello Serial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id133">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id134">Course link</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id135">Hardware needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id136">Schematic image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id137">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id138">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id139">Code</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MSP430 LunchBox</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Experiments manual as per NPTEL series</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/files/Experiment_Manual/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="experiments-manual-as-per-nptel-series">
<h1>Experiments manual as per NPTEL series<a class="headerlink" href="#experiments-manual-as-per-nptel-series" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-you-need">
<h2>What You Need<a class="headerlink" href="#what-you-need" title="Permalink to this headline">¶</a></h2>
<p>You need Swayam component kit, specifically made for this course requirements :-</p>
<a class="reference external image-reference" href="http://buy.swayam.components.sincgrid.com"><img alt="click to buy" class="align-center" src="../../_images/swayam_kit_info.jpg" /></a>
<div class="section" id="list-of-experiments">
<h3>List of Experiments<a class="headerlink" href="#list-of-experiments" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="experiment-1-lunchbox-hello-led">
<h3>Experiment 1 - LunchBox Hello LED<a class="headerlink" href="#experiment-1-lunchbox-hello-led" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to switch ON the LED present on LunchBox.</p>
</div>
<div class="section" id="hardware-needed">
<h2>Hardware needed<a class="headerlink" href="#hardware-needed" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="connections">
<h2>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="c1">//P1DIR |= BIT7;</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>                  <span class="c1">// Set P1.7 to output direction</span>

    <span class="c1">//P1OUT |= BIT7;</span>
   <span class="c1">//P1OUT |= 0x80;                  // Set P1.7 to HIGH voltage</span>

    <span class="c1">//P1OUT &amp;=~ BIT7;</span>
    <span class="n">P1OUT</span> <span class="o">&amp;=~</span> <span class="mh">0x80</span><span class="p">;</span>                  <span class="c1">// Set P1.7 to LOW voltage</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-2-lunchbox-hello-blink-using-msp430-h">
<h3>Experiment 2 - LunchBox Hello Blink (using MSP430.h)<a class="headerlink" href="#experiment-2-lunchbox-hello-blink-using-msp430-h" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id1">
<h2>Description<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to toggle the LED present on LunchBox.</p>
</div>
<div class="section" id="course-link">
<h2>Course link<a class="headerlink" href="#course-link" title="Permalink to this headline">¶</a></h2>
<p>Covered in lecture number - Lecture 21</p>
</div>
<div class="section" id="id2">
<h2>Hardware needed<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="schematic-image">
<h2>Schematic image<a class="headerlink" href="#schematic-image" title="Permalink to this headline">¶</a></h2>
<p>NA</p>
</div>
<div class="section" id="id3">
<h2>Connections<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id4">
<h2>Output<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>On board user led starts blinking</p>
</div>
<div class="section" id="id5">
<h2>Code<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>


<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>	<span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

	<span class="c1">//P1DIR |= BIT7;</span>
	<span class="n">P1DIR</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>            <span class="c1">// P1.7 (Red LED)</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span><span class="p">;</span>

        <span class="c1">//P1OUT |= BIT7;</span>
        <span class="n">P1OUT</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>              <span class="c1">//Red LED -&gt; ON</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>   <span class="c1">//delay</span>

        <span class="c1">//P1OUT &amp;=~ BIT7;</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x80</span><span class="p">;</span>             <span class="c1">//Red LED -&gt; OFF</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>   <span class="c1">//delay</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-2-lunchbox-hello-blink-using-pointers">
<h3>Experiment 2 - LunchBox Hello Blink (using pointers)<a class="headerlink" href="#experiment-2-lunchbox-hello-blink-using-pointers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id6">
<h2>Description<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to toggle the LED present on LunchBox. In this example, we have used direct memory mapped address of register to perform the blinking of led. We can rephrase this statement by saying no #include &lt;MSP430.h&gt; header is used, which contains mapping for register names and addresses. Comments are provided to see the correlation of addresses to register names. These addresses can be verfied from the MSP430G2553 datasheet.</p>
</div>
<div class="section" id="id7">
<h2>Course link<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>Covered in lecture number - Lecture 21</p>
</div>
<div class="section" id="id8">
<h2>Hardware needed<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>NA</p>
</div>
<div class="section" id="id9">
<h2>Schematic image<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>NA</p>
</div>
<div class="section" id="id10">
<h2>Connections<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>NA</p>
</div>
<div class="section" id="id11">
<h2>Output<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>On board user led starts blinking</p>
</div>
<div class="section" id="id12">
<h2>Code<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">//#include &lt;msp430.h&gt;</span>
<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="c1">//	WDTCTL = WDTPW | WDTHOLD;</span>
    <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0x0120</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x5A00</span> <span class="o">|</span> <span class="mh">0x0080</span><span class="p">;</span>
    <span class="cm">/* ! Stop Watchdog (Not recommended for code in production</span>
<span class="cm">     and devices working in field)</span>
<span class="cm">     */</span>

    <span class="c1">//P1DIR |= BIT7;</span>
    <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0x0022</span><span class="p">)</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
    <span class="c1">// P1.7 (Red LED)</span>

    <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="c1">//P1OUT |= BIT7;</span>
<span class="c1">//        P1OUT |= 0x80;              //Red LED -&gt; ON</span>
        <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0x0021</span><span class="p">)</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
        <span class="c1">//Red LED -&gt; ON</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">;</span>   <span class="c1">//delay</span>

        <span class="c1">//P1OUT &amp;=~ BIT7;</span>
        <span class="c1">//P1OUT &amp;= ~0x80;             //Red LED -&gt; OFF</span>
        <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0x0021</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x80</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">;</span>   <span class="c1">//delay</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-3-lunchbox-hello-switch">
<h3>Experiment 3 - LunchBox Hello Switch<a class="headerlink" href="#experiment-3-lunchbox-hello-switch" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id13">
<h2>Description<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings for toggling the state of onboard LED with switch present on LunchBox.</p>
</div>
<div class="section" id="id14">
<h2>Hardware needed<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id15">
<h2>Connections<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id16">
<h2>Output<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id17">
<h2>Code<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW  BIT3                    </span><span class="c1">// Switch -&gt; P1.3 (On-board Switch, Pull-Up configuration)</span>
<span class="cp">#define LED BIT7                    </span><span class="c1">// Red LED -&gt; P1.7 (On-Board LED, Active High Configuration)</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">LED</span><span class="p">;</span>                   <span class="c1">// Set LED pin -&gt; Output</span>

    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Set SW pin -&gt; Input</span>


    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">))</span>            <span class="c1">// If SW is Pressed</span>
        <span class="p">{</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>    <span class="c1">// Wait till SW Released</span>
            <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">LED</span><span class="p">;</span>           <span class="c1">// Toggle LED</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-4-lunchbox-debouncing-the-switch">
<h3>Experiment 4 - LunchBox Debouncing the Switch<a class="headerlink" href="#experiment-4-lunchbox-debouncing-the-switch" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id18">
<h2>Description<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>This example code is similar to that of LunchBox Hello Switch. The only difference is that in this code Switch bounces are ignored.</p>
</div>
<div class="section" id="id19">
<h2>Hardware needed<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id20">
<h2>Connections<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id21">
<h2>Output<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id22">
<h2>Code<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW  BIT3                    </span><span class="c1">// Switch -&gt; P1.3</span>
<span class="cp">#define LED BIT7                    </span><span class="c1">// Red LED -&gt; P1.7</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">LED</span><span class="p">;</span>                   <span class="c1">// Set LED pin -&gt; Output</span>
    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Set SW pin -&gt; Input</span>


    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">))</span>            <span class="c1">// If SW is Pressed</span>
        <span class="p">{</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>    <span class="c1">// Wait till SW Released</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">LED</span><span class="p">;</span>           <span class="c1">// Toggle LED</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-5-lunchbox-hello-switch-pull-down">
<h3>Experiment 5 - LunchBox Hello Switch Pull Down<a class="headerlink" href="#experiment-5-lunchbox-hello-switch-pull-down" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id23">
<h2>Description<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings for toggling the state of LED on LunchBox with an external switch connected with a Pull Down resistor.</p>
</div>
<div class="section" id="id24">
<h2>Hardware needed<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<p>Push Button Switch, Resistor (1 kohm), Breadboard, Connecting Wires</p>
</div>
<div class="section" id="id25">
<h2>Connections<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p>One end of Switch is connected to Vcc (3.3 V) and another end is at pin 1.4 of LunchBox. This pin is also connected to ground through a Pull Down resistor.</p>
</div>
<div class="section" id="id26">
<h2>Output<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id27">
<h2>Code<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW  BIT4                    </span><span class="c1">// Switch -&gt; P1.4 (External Switch, Pull-Down configuration)</span>
<span class="cp">#define LED BIT7                    </span><span class="c1">// Red LED -&gt; P1.7 (External Switch, Active-High configuration)</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">LED</span><span class="p">;</span>                   <span class="c1">// Set LED pin -&gt; Output</span>

    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Set SW pin -&gt; Input</span>
    <span class="n">P1REN</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                    <span class="c1">// Enable Resistor for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">&amp;=~</span> <span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Select Pull down for SW pin</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">)</span>               <span class="c1">// If SW is Pressed</span>
        <span class="p">{</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="k">while</span><span class="p">((</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>     <span class="c1">// Wait till SW Released</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">LED</span><span class="p">;</span>           <span class="c1">// Toggle LED</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-6-lunchbox-helloswitch-pull-up">
<h3>Experiment 6 - LunchBox HelloSwitch Pull Up<a class="headerlink" href="#experiment-6-lunchbox-helloswitch-pull-up" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id28">
<h2>Description<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings for toggling the state of LED on LunchBox with an external switch connected with a Pull Up resistor.</p>
</div>
<div class="section" id="id29">
<h2>Hardware needed<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<p>Push Button Switch, Resistor (1 kohm), Breadboard, Connecting Wires.</p>
</div>
<div class="section" id="id30">
<h2>Connections<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<p>One end of Switch is connected to Ground and another end is at pin 1.4 of LunchBox. This pin is also connected to Vcc (3.3 V) through a Pull Up resistor.</p>
</div>
<div class="section" id="id31">
<h2>Output<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id32">
<h2>Code<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW  BIT4                    </span><span class="c1">// Switch -&gt; P1.4 (External Switch, Pull-Up configuration)</span>
<span class="cp">#define LED BIT7                    </span><span class="c1">// Red LED -&gt; P1.7 (External Switch, Active-High configuration)</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">LED</span><span class="p">;</span>                   <span class="c1">// Set LED pin -&gt; Output</span>

    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Set SW pin -&gt; Input</span>
    <span class="n">P1REN</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                    <span class="c1">// Enable Resistor for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                    <span class="c1">// Select Pull Up for SW pin</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">))</span>            <span class="c1">// If SW is Pressed</span>
        <span class="p">{</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>    <span class="c1">// Wait till SW Released</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">LED</span><span class="p">;</span>           <span class="c1">// Toggle LED</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-7-lunchbox-helloclock">
<h3>Experiment 7 - LunchBox HelloClock<a class="headerlink" href="#experiment-7-lunchbox-helloclock" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id33">
<h2>Description<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to toggle the LED present on LunchBox.</p>
</div>
<div class="section" id="id34">
<h2>Hardware needed<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id35">
<h2>Connections<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id36">
<h2>Output<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id37">
<h2>Code<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define LED BIT7                        </span><span class="c1">// Led Pin</span>

<span class="cp">#define SW1 BIT3                        </span><span class="c1">// 1.5Khz</span>
<span class="cp">#define SW2 BIT4                        </span><span class="c1">// 3Khz</span>
<span class="cp">#define SW3 BIT5                        </span><span class="c1">// 12Khz</span>

<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>                <span class="c1">// Volatile to prevent removal</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * Function to take input from 3 switches and change CPU clock accordingly</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">switch_input</span><span class="p">()</span>
<span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW1</span><span class="p">))</span>                   <span class="c1">// If SW1 is Pressed</span>
    <span class="p">{</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>           <span class="c1">// Wait 20ms to debounce</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW1</span><span class="p">));</span>           <span class="c1">// Wait till SW Released</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>           <span class="c1">// Wait 20ms to debounce</span>

        <span class="n">BCSCTL2</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">BIT5</span> <span class="o">+</span> <span class="n">BIT4</span><span class="p">);</span>      <span class="c1">//Reset VLO divider</span>
        <span class="n">BCSCTL2</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BIT5</span> <span class="o">+</span> <span class="n">BIT4</span><span class="p">);</span>       <span class="c1">//VLO = 12kHz/8 = 1.5kHz</span>
    <span class="p">}</span>


    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW2</span><span class="p">))</span>                   <span class="c1">// If SW is Pressed</span>
    <span class="p">{</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>           <span class="c1">// Wait 20ms to debounce</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW2</span><span class="p">));</span>           <span class="c1">// Wait till SW Released</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>           <span class="c1">// Wait 20ms to debounce</span>

        <span class="n">BCSCTL2</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">BIT5</span> <span class="o">+</span> <span class="n">BIT4</span><span class="p">);</span>      <span class="c1">//Reset VLO divider</span>
        <span class="n">BCSCTL2</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BIT4</span><span class="p">);</span>              <span class="c1">//VLO = 12kHz/4 = 3kHz</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW3</span><span class="p">))</span>                   <span class="c1">// If SW is Pressed</span>
    <span class="p">{</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>           <span class="c1">// Wait 20ms to debounce</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW3</span><span class="p">));</span>           <span class="c1">// Wait till SW Released</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>           <span class="c1">// Wait 20ms to debounce</span>

        <span class="n">BCSCTL2</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">BIT5</span> <span class="o">+</span> <span class="n">BIT4</span><span class="p">);</span>      <span class="c1">//VLO = 12kHz/1 = 12kHz</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling GPIO on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_GPIO</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">LED</span><span class="p">;</span>                       <span class="c1">//P1.7 is set as Output</span>
    <span class="n">P1DIR</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">SW1</span> <span class="o">+</span> <span class="n">SW2</span> <span class="o">+</span> <span class="n">SW3</span><span class="p">);</span>        <span class="c1">//P1.3, P1.4, P1.5 are set as Input</span>
<span class="p">}</span>


<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t enabling VLO  on Lunch Box</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_VLO</span><span class="p">()</span>
<span class="p">{</span>
   <span class="n">BCSCTL3</span> <span class="o">|=</span> <span class="n">LFXT1S_2</span><span class="p">;</span>                 <span class="c1">// LFXT1 = VLO</span>
   <span class="k">do</span><span class="p">{</span>
       <span class="n">IFG1</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">OFIFG</span><span class="p">;</span>                  <span class="c1">// Clear oscillator fault flag</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span>         <span class="c1">// Delay</span>
     <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">OFIFG</span><span class="p">);</span>            <span class="c1">// Test osc fault flag</span>

   <span class="n">BCSCTL2</span> <span class="o">|=</span> <span class="n">SELM_3</span><span class="p">;</span>                   <span class="c1">// MCLK = VLO</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * main.c</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">register_settings_for_VLO</span><span class="p">();</span>        <span class="c1">//Register settings for VLO</span>
    <span class="n">register_settings_for_GPIO</span><span class="p">();</span>       <span class="c1">//Register settings for GPIO</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">switch_input</span><span class="p">();</span>                 <span class="c1">//Switch Input</span>

        <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">LED</span><span class="p">;</span>                   <span class="c1">//LED Toggle</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-8-lunchbox-helloresetsource">
<h3>Experiment 8 - LunchBox HelloResetSource<a class="headerlink" href="#experiment-8-lunchbox-helloresetsource" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id38">
<h2>Description<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to toggle the LED present on LunchBox.</p>
</div>
<div class="section" id="id39">
<h2>Hardware needed<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id40">
<h2>Connections<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id41">
<h2>Output<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id42">
<h2>Code<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>

<span class="cp">#define  LED1 BIT0                                  </span><span class="c1">// LED to indicate that main() has started</span>
<span class="cp">#define  LED2 BIT1                                  </span><span class="c1">// LED to indicate that program is executing</span>
<span class="cp">#define  LEDA BIT2                                  </span><span class="c1">// To indicate Power On Reset</span>
<span class="cp">#define  LEDB BIT3                                  </span><span class="c1">// To indicate Watch dog Reset</span>
<span class="cp">#define  LEDC BIT4                                  </span><span class="c1">// To indicate External Reset (by reset switch)</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling GPIO on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_GPIO</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">LED1</span> <span class="o">+</span> <span class="n">LED2</span> <span class="o">+</span> <span class="n">LEDA</span> <span class="o">+</span> <span class="n">LEDB</span> <span class="o">+</span> <span class="n">LEDC</span><span class="p">);</span>    <span class="c1">// P1.0 to P1.4 as output</span>

    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">LED1</span><span class="p">;</span>                                  <span class="c1">// LED1 representing main() is set</span>

    <span class="n">P1OUT</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">LED2</span> <span class="o">+</span> <span class="n">LEDA</span> <span class="o">+</span> <span class="n">LEDB</span> <span class="o">+</span> <span class="n">LEDC</span><span class="p">);</span>          <span class="c1">// Turning all other LEDs OFF</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t check source of reset on Lunch Box</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">checking_reset_source</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">PORIFG</span><span class="p">)</span>                              <span class="c1">// Check for Power on Reset flag (POR)</span>
    <span class="p">{</span>
        <span class="n">P1OUT</span><span class="o">|=</span> <span class="n">LEDA</span><span class="p">;</span>                               <span class="c1">// Turning LEDA On</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LEDB</span><span class="p">;</span>                             <span class="c1">// Turning LEDB Off</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LEDC</span><span class="p">;</span>                             <span class="c1">// Turning LEDC Off</span>

        <span class="cm">/* Settings for Watchdog Timer register</span>
<span class="cm">                Giving Watchdog Timer Password</span>
<span class="cm">                Clearing Watchdog counter to 0000h</span>
<span class="cm">                Watchdog Source select --&gt; ACLK</span>
<span class="cm">                Watchdog Timer interval set to generate watchdog reset at 2 secs</span>
<span class="cm">        */</span>
        <span class="n">WDTCTL</span> <span class="o">=</span> <span class="p">(</span><span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTCNTCL</span> <span class="o">+</span> <span class="n">WDTSSEL</span> <span class="o">+</span> <span class="n">WDTIS0</span><span class="p">);</span>

        <span class="n">IFG1</span> <span class="o">&amp;=~</span> <span class="n">PORIFG</span><span class="p">;</span>                            <span class="c1">// Clearing Power on Reset flag</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">RSTIFG</span><span class="p">)</span>                         <span class="c1">// Check for External Reset flag (RST)</span>
    <span class="p">{</span>
        <span class="n">P1OUT</span><span class="o">|=</span> <span class="n">LEDC</span><span class="p">;</span>                               <span class="c1">// Turning LEDC On</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LEDA</span><span class="p">;</span>                             <span class="c1">// Turning LEDA Off</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LEDB</span><span class="p">;</span>                             <span class="c1">// Turning LEDB Off</span>

        <span class="cm">/* Settings Watchdog Timer register</span>
<span class="cm">                Giving Watchdog Timer Password</span>
<span class="cm">                Clearing Watchdog counter to 0000h</span>
<span class="cm">                Watchdog Source select --&gt; ACLK</span>
<span class="cm">                Watchdog Timer interval set to generate watchdog reset at 2 secs</span>
<span class="cm">        */</span>
        <span class="n">WDTCTL</span> <span class="o">=</span> <span class="p">(</span><span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTCNTCL</span> <span class="o">+</span> <span class="n">WDTSSEL</span> <span class="o">+</span> <span class="n">WDTIS0</span><span class="p">);</span>

        <span class="n">IFG1</span> <span class="o">&amp;=~</span> <span class="n">RSTIFG</span><span class="p">;</span>                            <span class="c1">// Clearing External Reset flag</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">WDTIFG</span><span class="p">)</span>                         <span class="c1">// Check for Watch Dog Reset flag (WDT)</span>
    <span class="p">{</span>
        <span class="n">P1OUT</span><span class="o">|=</span> <span class="n">LEDB</span><span class="p">;</span>                               <span class="c1">// Turning LEDB On</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LEDA</span><span class="p">;</span>                             <span class="c1">// Turning LEDA Off</span>
        <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LEDC</span><span class="p">;</span>                             <span class="c1">// Turning LEDC Off</span>

        <span class="n">IFG1</span> <span class="o">&amp;=~</span> <span class="n">PORIFG</span><span class="p">;</span>                            <span class="c1">// Clearing Power on Reset flag</span>
        <span class="n">IFG1</span> <span class="o">&amp;=~</span> <span class="n">RSTIFG</span><span class="p">;</span>                            <span class="c1">// Clearing External Reset flag</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
      <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>   <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>
      <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

      <span class="n">BCSCTL1</span> <span class="o">|=</span> <span class="n">DIVA_3</span><span class="p">;</span>                            <span class="c1">// Dividing ACLK by 8, 32768Hz/8 = 4096Hz</span>

      <span class="n">register_settings_for_GPIO</span><span class="p">();</span>

      <span class="cm">/* This loop checks for Oscillator fault flag to reset means</span>
<span class="cm">         it delays execution until external crystal is Power On  */</span>

      <span class="k">do</span>
      <span class="p">{</span>
         <span class="n">IFG1</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">OFIFG</span><span class="p">;</span>                            <span class="c1">// Clear oscillator fault flag</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span> <span class="n">i</span> <span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span>                  <span class="c1">// Delay, minimum value of i = 5000</span>
      <span class="p">}</span>  <span class="k">while</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">OFIFG</span><span class="p">);</span>                      <span class="c1">// Test osc fault flag</span>

      <span class="n">checking_reset_source</span><span class="p">();</span>

      <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">LED2</span><span class="p">;</span>                            <span class="c1">// Toggle LED</span>
          <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">1000000</span><span class="p">);</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-9-lunchbox-hellointerrupt">
<h3>Experiment 9 - LunchBox HelloInterrupt<a class="headerlink" href="#experiment-9-lunchbox-hellointerrupt" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id43">
<h2>Description<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h2>
<p>This example code constitutes functions and register settings for toggling the state of onboard LED with onboard switch having interrupt on rising edge on Lunchbox.</p>
</div>
<div class="section" id="id44">
<h2>Hardware needed<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id45">
<h2>Connections<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id46">
<h2>Output<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id47">
<h2>Code<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW      BIT3                    </span><span class="c1">// Switch -&gt; P1.3</span>
<span class="cp">#define RED     BIT7                    </span><span class="c1">// Red LED -&gt; P1.7</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>                       <span class="c1">// Set LED pin -&gt; Output</span>
    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Set SW pin -&gt; Input</span>
    <span class="n">P1REN</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Enable Resistor for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Select Pull Up for SW pin</span>

    <span class="n">P1IES</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Select Interrupt on Rising Edge</span>
    <span class="n">P1IE</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                         <span class="c1">// Enable Interrupt on SW pin</span>

    <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">GIE</span><span class="p">);</span>             <span class="c1">// Enable CPU Interrupt</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for switch interrupt*/</span>
<span class="cp">#pragma vector=PORT1_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Port_1</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">P1IFG</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">)</span>                      <span class="c1">// If SW is Pressed</span>
    <span class="p">{</span>
        <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">RED</span><span class="p">;</span>                   <span class="c1">// Toggle RED LED</span>
        <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>       <span class="c1">//delay</span>
        <span class="n">P1IFG</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Clear SW interrupt flag</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-10-lunchbox-hellointerrupt-rising">
<h3>Experiment 10 - LunchBox HelloInterrupt Rising<a class="headerlink" href="#experiment-10-lunchbox-hellointerrupt-rising" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id48">
<h2>Description<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings for toggling the state of onboard LED with an external switch having interrupt on rising edge.</p>
</div>
<div class="section" id="id49">
<h2>Hardware needed<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h2>
<p>Push Button Switch, Resistor (1 kohm), Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id50">
<h2>Connections<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h2>
<p>One end of switch is connected to Ground and another end is connected to pin 1.4 of Lunchbox. This pin is also connected to Vcc (3.3 V) through a pull-up resistor.</p>
</div>
<div class="section" id="id51">
<h2>Output<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id52">
<h2>Code<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW      BIT4                    </span><span class="c1">// Switch -&gt; P1.4</span>
<span class="cp">#define RED     BIT7                    </span><span class="c1">// Red LED -&gt; P1.7</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>                       <span class="c1">// Set LED pin -&gt; Output</span>
    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Set SW pin -&gt; Input</span>
    <span class="n">P1REN</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Enable Resistor for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Select Pull Up for SW pin</span>

    <span class="n">P1IES</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Select Interrupt on Rising Edge</span>
    <span class="n">P1IE</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                         <span class="c1">// Enable Interrupt on SW pin</span>

    <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">GIE</span><span class="p">);</span>             <span class="c1">// Enable CPU Interrupt</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for switch interrupt*/</span>
<span class="cp">#pragma vector=PORT1_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Port_1</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">P1IFG</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">)</span>                      <span class="c1">// If SW is Pressed</span>
    <span class="p">{</span>
        <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">RED</span><span class="p">;</span>                   <span class="c1">// Toggle RED LED</span>
        <span class="n">P1IFG</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Clear SW interrupt flag</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-11-lunchbox-hello-interrupt-on-falling-edge">
<h3>Experiment 11 - LunchBox Hello Interrupt on Falling Edge<a class="headerlink" href="#experiment-11-lunchbox-hello-interrupt-on-falling-edge" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id53">
<h2>Description<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings for toggling the state of onboard LED with an external switch having interrupt on falling edge.</p>
</div>
<div class="section" id="id54">
<h2>Hardware needed<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h2>
<p>Push Button Switch, Resistor (1 kohm), Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id55">
<h2>Connections<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h2>
<p>One end of switch is connected to Ground and another end is connected to pin 1.4 of Lunchbox. This pin is also connected to Vcc (3.3 V) through a pull-up resistor.</p>
</div>
<div class="section" id="id56">
<h2>Output<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id57">
<h2>Code<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW      BIT4                    </span><span class="c1">// Switch -&gt; P1.4</span>
<span class="cp">#define RED     BIT7                    </span><span class="c1">// Red LED -&gt; P1.7</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>                       <span class="c1">// Set LED pin -&gt; Output</span>
    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Set SW pin -&gt; Input</span>
    <span class="n">P1REN</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Enable Resistor for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Select Pull Up for SW pin</span>

    <span class="n">P1IES</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Select Interrupt on Falling Edge</span>
    <span class="n">P1IE</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                         <span class="c1">// Enable Interrupt on SW pin</span>

    <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">GIE</span><span class="p">);</span>             <span class="c1">// Enable CPU Interrupt</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for switch interrupt*/</span>
<span class="cp">#pragma vector=PORT1_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Port_1</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">P1IFG</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">)</span>                      <span class="c1">// If SW is Pressed</span>
    <span class="p">{</span>
        <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">RED</span><span class="p">;</span>                   <span class="c1">// Toggle RED LED</span>
        <span class="n">P1IFG</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Clear SW interrupt flag</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-12-lunchbox-hello-seven-segment-display">
<h3>Experiment 12 - LunchBox Hello Seven Segment Display<a class="headerlink" href="#experiment-12-lunchbox-hello-seven-segment-display" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id58">
<h2>Description<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for increasing count on every press of external switch. The count will increase from 0 to F (in Hexadecimal).</p>
</div>
<div class="section" id="id59">
<h2>Hardware needed<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h2>
<p>Single Seven Segment Display (SSD) - Common Cathode, Resistors - 270 ohm (quanitity - 8), 1 kohm (quanitity - 1), Toggle Push Button Switch, Connecting wires.</p>
</div>
<div class="section" id="id60">
<h2>Connections<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h2>
<p>One end of switch is connected to Ground and another end is connected to pin 2.3 of Lunchbox, this pin is also connected to Vcc (3.3 V) through a pull-up resistor. Ground pin of SSD is connected to Ground of LunchBox, pins a,b,c,d,e,f,g,decimal of SSD are connected to pins 1.0 to 1.7 of LunchBox respectively through resistor of 270 ohm.</p>
</div>
<div class="section" id="id61">
<h2>Output<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id62">
<h2>Code<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>

<span class="cp">#define SW      BIT3                    </span><span class="c1">// Switch -&gt; P2.3</span>

<span class="c1">// Define Pin Mapping of 7-segment Display</span>
<span class="c1">// Segments are connected to P1.0 - P1.7</span>
<span class="cp">#define SEG_A   BIT0</span>
<span class="cp">#define SEG_B   BIT1</span>
<span class="cp">#define SEG_C   BIT2</span>
<span class="cp">#define SEG_D   BIT3</span>
<span class="cp">#define SEG_E   BIT4</span>
<span class="cp">#define SEG_F   BIT5</span>
<span class="cp">#define SEG_G   BIT6</span>
<span class="cp">#define SEG_DP  BIT7</span>

<span class="c1">// Define each digit according to truth table</span>
<span class="cp">#define D0  (SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F)</span>
<span class="cp">#define D1  (SEG_B + SEG_C)</span>
<span class="cp">#define D2  (SEG_A + SEG_B + SEG_D + SEG_E + SEG_G)</span>
<span class="cp">#define D3  (SEG_A + SEG_B + SEG_C + SEG_D + SEG_G)</span>
<span class="cp">#define D4  (SEG_B + SEG_C + SEG_F + SEG_G)</span>
<span class="cp">#define D5  (SEG_A + SEG_C + SEG_D + SEG_F + SEG_G)</span>
<span class="cp">#define D6  (SEG_A + SEG_C + SEG_D + SEG_E + SEG_F + SEG_G)</span>
<span class="cp">#define D7  (SEG_A + SEG_B + SEG_C)</span>
<span class="cp">#define D8  (SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F + SEG_G)</span>
<span class="cp">#define D9  (SEG_A + SEG_B + SEG_C + SEG_D + SEG_F + SEG_G)</span>
<span class="cp">#define DA  (SEG_A + SEG_B + SEG_C + SEG_E + SEG_F + SEG_G)</span>
<span class="cp">#define DB  (SEG_C + SEG_D + SEG_E + SEG_F + SEG_G)</span>
<span class="cp">#define DC  (SEG_A + SEG_D + SEG_E + SEG_F)</span>
<span class="cp">#define DD  (SEG_B + SEG_C + SEG_D + SEG_E + SEG_G)</span>
<span class="cp">#define DE  (SEG_A + SEG_D + SEG_E + SEG_F + SEG_G)</span>
<span class="cp">#define DF  (SEG_A + SEG_E + SEG_F + SEG_G)</span>


<span class="c1">// Define mask value for all digit segments except DP</span>
<span class="cp">#define DMASK   ~(SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F + SEG_G)</span>

<span class="c1">// Store digits in array for display</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">digits</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">D0</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">D3</span><span class="p">,</span> <span class="n">D4</span><span class="p">,</span> <span class="n">D5</span><span class="p">,</span> <span class="n">D6</span><span class="p">,</span> <span class="n">D7</span><span class="p">,</span> <span class="n">D8</span><span class="p">,</span> <span class="n">D9</span><span class="p">,</span> <span class="n">DA</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">DC</span><span class="p">,</span> <span class="n">DD</span><span class="p">,</span> <span class="n">DE</span><span class="p">,</span> <span class="n">DF</span><span class="p">};</span>

<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watch dog (Not recommended for code in production and devices working in field)</span>

    <span class="c1">// Initialize 7-segment pins as Output</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SEG_A</span> <span class="o">+</span> <span class="n">SEG_B</span> <span class="o">+</span> <span class="n">SEG_C</span> <span class="o">+</span> <span class="n">SEG_D</span> <span class="o">+</span> <span class="n">SEG_E</span><span class="o">+</span> <span class="n">SEG_F</span> <span class="o">+</span> <span class="n">SEG_G</span> <span class="o">+</span> <span class="n">SEG_DP</span><span class="p">);</span>

    <span class="n">P2DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Set SW pin -&gt; Input</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P2IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">))</span>                <span class="c1">// If SW is Pressed</span>
        <span class="p">{</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>      <span class="c1">//Delay to avoid Switch Bounce</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P2IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>        <span class="c1">// Wait till SW Released</span>
            <span class="n">i</span><span class="o">++</span><span class="p">;</span>                        <span class="c1">//Increment count</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">P1OUT</span> <span class="o">=</span> <span class="p">(</span><span class="n">P1OUT</span> <span class="o">&amp;</span> <span class="n">DMASK</span><span class="p">)</span> <span class="o">+</span> <span class="n">digits</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>    <span class="c1">// Display current digit</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-13-lunchbox-hello-low-power-mode-lpm">
<h3>Experiment 13 - LunchBox Hello Low Power Mode (LPM)<a class="headerlink" href="#experiment-13-lunchbox-hello-low-power-mode-lpm" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id63">
<h2>Description<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings for operating MSP430 controller in Low Power Mode. In this example code state of onboard LED on LunchBox is toggled with onboard switch having interrupt on rising edge while running the microcontroller in Low Power Mode.</p>
</div>
<div class="section" id="id64">
<h2>Hardware needed<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id65">
<h2>Connections<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id66">
<h2>Output<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id67">
<h2>Code<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define SW      BIT3                    </span><span class="c1">// Switch -&gt; P1.3</span>
<span class="cp">#define RED     BIT7                    </span><span class="c1">// Red LED -&gt; P1.7</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watch dog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>                       <span class="c1">// Set LED pin -&gt; Output</span>
    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Set SW pin -&gt; Input</span>
    <span class="n">P1REN</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Enable Resistor for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                        <span class="c1">// Select Pull Up for SW pin</span>
    <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RED</span><span class="p">;</span>                      <span class="c1">// Turn RED LED off</span>
    <span class="n">P1IES</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                       <span class="c1">// Select Interrupt on Rising Edge</span>
    <span class="n">P1IE</span> <span class="o">|=</span> <span class="n">SW</span><span class="p">;</span>                         <span class="c1">// Enable Interrupt on SW pin</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//__bis_SR_register(GIE);           // Enable CPU Interrupt</span>
        <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">LPM4_bits</span> <span class="o">+</span> <span class="n">GIE</span><span class="p">);</span> <span class="c1">// Enter LPM4 and Enable CPU Interrupt</span>

        <span class="n">P1OUT</span> <span class="o">^=</span> <span class="n">RED</span><span class="p">;</span>                       <span class="c1">// Toggle RED LED</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for switch interrupt*/</span>
<span class="cp">#pragma vector=PORT1_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Port_1</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">__bic_SR_register_on_exit</span><span class="p">(</span><span class="n">LPM4_bits</span> <span class="o">+</span> <span class="n">GIE</span><span class="p">);</span>     <span class="c1">// Exit LPM4 on return to main</span>
    <span class="n">P1IFG</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                                   <span class="c1">// Clear SW interrupt flag</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-14-lunchbox-hellolcd">
<h3>Experiment 14 - LunchBox HelloLCD<a class="headerlink" href="#experiment-14-lunchbox-hellolcd" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id68">
<h2>Description<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to toggle the LED present on LunchBox.</p>
</div>
<div class="section" id="id69">
<h2>Hardware needed<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id70">
<h2>Connections<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id71">
<h2>Output<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id72">
<h2>Code<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>

<span class="cp">#define CMD         0</span>
<span class="cp">#define DATA        1</span>

<span class="cp">#define LCD_OUT     P1OUT</span>
<span class="cp">#define LCD_DIR     P1DIR</span>
<span class="cp">#define D4          BIT4</span>
<span class="cp">#define D5          BIT5</span>
<span class="cp">#define D6          BIT6</span>
<span class="cp">#define D7          BIT7</span>
<span class="cp">#define RS          BIT2</span>
<span class="cp">#define EN          BIT3</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Delay function for producing delay in 0.1 ms increments</span>
<span class="cm"> *@param t milliseconds to be delayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to pulse EN pin after data is written</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">pulseEN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">EN</span><span class="p">;</span>                              <span class="c1">// Giving a falling edge at EN pin</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to write data/command to LCD</span>
<span class="cm"> *@param value Value to be written to LED</span>
<span class="cm"> *@param mode Mode -&gt; Command or Data</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_write</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CMD</span><span class="p">)</span>
        <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RS</span><span class="p">;</span>             <span class="c1">// Set RS -&gt; LOW for Command mode</span>
    <span class="k">else</span>
        <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">RS</span><span class="p">;</span>              <span class="c1">// Set RS -&gt; HIGH for Data mode</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>              <span class="c1">// Write high nibble first</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>       <span class="c1">// Write low nibble next</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to print a string on LCD</span>
<span class="cm"> *@param *s pointer to the character to be written.</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_print</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lcd_write</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to move cursor to desired position on LCD</span>
<span class="cm"> *@param row Row Cursor of the LCD</span>
<span class="cm"> *@param col Column Cursor of the LCD</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_setCursor</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">row</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">row_offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">};</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row_offsets</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">CMD</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Initialize LCD</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LCD_DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>                     <span class="c1">// Wait for power up ( 15ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 1</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                      <span class="c1">// Wait ( 4.1 ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x32</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 2</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                       <span class="c1">// Wait ( 100 us )</span>

    <span class="c1">// All subsequent commands take 40 us to execute, except clear &amp; cursor return (1.64 ms)</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// 4 bit mode, 2 line</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x0C</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Display ON, Cursor OFF, Blink OFF</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Clear screen</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Auto Increment Cursor</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// Goto Row 1 Column 1</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">lcd_init</span><span class="p">();</span>                     <span class="c1">// Initialising LCD</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>             <span class="c1">// Cursor position (0,1)</span>
    <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Hello Embedded&quot;</span><span class="p">);</span>    <span class="c1">// Print</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>             <span class="c1">// Cursor position (1,3)</span>
    <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Systems!&quot;</span><span class="p">);</span>          <span class="c1">// Print</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-15-lunchbox-hello-lcd-with-custom-character">
<h3>Experiment 15 - LunchBox Hello LCD With Custom Character<a class="headerlink" href="#experiment-15-lunchbox-hello-lcd-with-custom-character" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id73">
<h2>Description<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h2>
<p>This example code provides the functions and register settings to toggle the LED present on LunchBox.</p>
</div>
<div class="section" id="id74">
<h2>Hardware needed<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id75">
<h2>Connections<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id76">
<h2>Output<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id77">
<h2>Code<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>

<span class="cp">#define CMD         0</span>
<span class="cp">#define DATA        1</span>

<span class="cp">#define LCD_OUT     P1OUT</span>
<span class="cp">#define LCD_DIR     P1DIR</span>
<span class="cp">#define D4          BIT4</span>
<span class="cp">#define D5          BIT5</span>
<span class="cp">#define D6          BIT6</span>
<span class="cp">#define D7          BIT7</span>
<span class="cp">#define RS          BIT2</span>
<span class="cp">#define EN          BIT3</span>

<span class="cp">#define SW          BIT3</span>

<span class="cp">#define LCD_SETCGRAMADDR 0x40</span>

<span class="c1">//Heart character</span>
<span class="kt">uint8_t</span> <span class="n">heart</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x0A</span><span class="p">,</span>
  <span class="mh">0x1F</span><span class="p">,</span>
  <span class="mh">0x1F</span><span class="p">,</span>
  <span class="mh">0x1F</span><span class="p">,</span>
  <span class="mh">0x0E</span><span class="p">,</span>
  <span class="mh">0x04</span><span class="p">,</span>
  <span class="mh">0x00</span>
<span class="p">};</span>

<span class="c1">//</span>
<span class="cm">/**</span>
<span class="cm"> *@brief Delay function for producing delay in 0.1 ms increments</span>
<span class="cm"> *@param t milliseconds to be delayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to pulse EN pin after data is written</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">pulseEN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">EN</span><span class="p">;</span>                              <span class="c1">// Giving a falling edge at EN pin</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to write data/command to LCD</span>
<span class="cm"> *@param value Value to be written to LED</span>
<span class="cm"> *@param mode Mode -&gt; Command or Data</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_write</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CMD</span><span class="p">)</span>
        <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RS</span><span class="p">;</span>             <span class="c1">// Set RS -&gt; LOW for Command mode</span>
    <span class="k">else</span>
        <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">RS</span><span class="p">;</span>              <span class="c1">// Set RS -&gt; HIGH for Data mode</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>              <span class="c1">// Write high nibble first</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>       <span class="c1">// Write low nibble next</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to print a string on LCD</span>
<span class="cm"> *@param *s pointer to the character to be written.</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_print</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lcd_write</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to move cursor to desired position on LCD</span>
<span class="cm"> *@param row Row Cursor of the LCD</span>
<span class="cm"> *@param col Column Cursor of the LCD</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_setCursor</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">row</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">row_offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">};</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row_offsets</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">CMD</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Allows us to fill the first 8 CGRAM locations with custom characters</span>
<span class="cm"> *@param location Row Cursor of the LCD</span>
<span class="cm"> *@param charmap Column Cursor of the LCD</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_createChar</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">location</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">charmap</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">location</span> <span class="o">&amp;=</span> <span class="mh">0x7</span><span class="p">;</span> <span class="c1">// we only have 8 locations 0-7</span>
  <span class="n">lcd_write</span><span class="p">(</span><span class="n">LCD_SETCGRAMADDR</span> <span class="o">|</span> <span class="p">(</span><span class="n">location</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="n">CMD</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">lcd_write</span><span class="p">(</span><span class="n">charmap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">DATA</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Initialize LCD</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LCD_DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>                     <span class="c1">// Wait for power up ( 15ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 1</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                      <span class="c1">// Wait ( 4.1 ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x32</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 2</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                       <span class="c1">// Wait ( 100 us )</span>

    <span class="c1">// All subsequent commands take 40 us to execute, except clear &amp; cursor return (1.64 ms)</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// 4 bit mode, 2 line</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x0C</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Display ON, Cursor OFF, Blink OFF</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Auto Increment Cursor</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Clear screen</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// Goto Row 1 Column 1</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="kt">uint8_t</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">P2DIR</span> <span class="o">&amp;=~</span> <span class="n">SW</span><span class="p">;</span>

    <span class="n">lcd_init</span><span class="p">();</span>                             <span class="c1">// Initialising LCD</span>

    <span class="n">lcd_createChar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">heart</span><span class="p">);</span>                <span class="c1">// Creating Custom Character</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>                     <span class="c1">// Cursor position (0,1)</span>
    <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Hello Embedded&quot;</span><span class="p">);</span>            <span class="c1">// Print</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>                     <span class="c1">// Cursor position (1,3)</span>
    <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Systems&quot;</span><span class="p">);</span>                   <span class="c1">// Print</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P2IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">))</span>            <span class="c1">// If SW is Pressed</span>
        <span class="p">{</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P2IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>    <span class="c1">// Wait till SW Released</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>  <span class="c1">// Wait 20ms to debounce</span>
            <span class="k">switch</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="p">{</span>
                    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>                     <span class="c1">// Cursor position (1,3)</span>
                    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>                  <span class="c1">// Printing Custom Char (Heart)</span>
                    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>                    <span class="c1">// Cursor position (1,11)</span>
                    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>                  <span class="c1">// Printing Custom Char (Heart)</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="p">{</span>
                    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>                     <span class="c1">// Cursor position (1,3)</span>
                    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>                  <span class="c1">// Printing Space</span>
                    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>                    <span class="c1">// Cursor position (1,11)</span>
                    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>                  <span class="c1">// Printing Space</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-16-lunchbox-hello-timer">
<h3>Experiment 16 - LunchBox Hello Timer<a class="headerlink" href="#experiment-16-lunchbox-hello-timer" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id78">
<h2>Description<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for generating Timer interrupt at 1 second. Using these settings, an eight bit binary up counter implementation has been represented on eight LEDs.</p>
</div>
<div class="section" id="id79">
<h2>Hardware needed<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h2>
<p>Eight LEDs, Eight Resistors, Breadboard, Connecting Wires.</p>
</div>
<div class="section" id="id80">
<h2>Connections<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h2>
<p>Port 1 pins of Lunchbox are connected to Eight LEDs via resistors in series. Pin 1.0 will represent LSB and Pin 1.7 will represent MSB of that Binary up counter.</p>
</div>
<div class="section" id="id81">
<h2>Output<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id82">
<h2>Code<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>

<span class="k">volatile</span> <span class="kt">char</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling GPIO on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_GPIO</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="mh">0xFF</span><span class="p">;</span>                          <span class="c1">//P1.0 to P1.7 are set as Output</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="mh">0x00</span><span class="p">;</span>                          <span class="c1">//Initially they are set to logic zero</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t enabling TIMER0 on Lunch Box</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_TIMER0</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">CCTL0</span> <span class="o">=</span> <span class="n">CCIE</span><span class="p">;</span>                           <span class="c1">// CCR0 interrupt enabled</span>
    <span class="n">TACTL</span> <span class="o">=</span> <span class="n">TASSEL_1</span> <span class="o">+</span> <span class="n">MC_1</span><span class="p">;</span>                <span class="c1">// ACLK = 32768 Hz, upmode</span>
    <span class="n">CCR0</span> <span class="o">=</span>  <span class="mi">32768</span><span class="p">;</span>                          <span class="c1">// 1 Hz</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>             <span class="c1">//! Stop Watch dog (Not recommended for code in production and devices working in field)</span>

  <span class="k">do</span><span class="p">{</span>
         <span class="n">IFG1</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">OFIFG</span><span class="p">;</span>                <span class="c1">// Clear oscillator fault flag</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span>       <span class="c1">// Delay</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">OFIFG</span><span class="p">);</span>             <span class="c1">// Test osc fault flag</span>

  <span class="n">register_settings_for_TIMER0</span><span class="p">();</span>
  <span class="n">register_settings_for_GPIO</span><span class="p">();</span>
  <span class="n">_BIS_SR</span><span class="p">(</span><span class="n">LPM3_bits</span> <span class="o">+</span> <span class="n">GIE</span><span class="p">);</span>             <span class="c1">// Enter LPM3 w/ interrupt</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for TIMER0 interrupt vector*/</span>
<span class="cp">#pragma vector= TIMER0_A0_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Timer_A</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="n">P1OUT</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>                      <span class="c1">//Assign value of Count to PORT 1 to represent it as binary number</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-17-lunchbox-hellosoftwarepwm-large-delay">
<h3>Experiment 17 -LunchBox HelloSoftwarePWM (Large Delay)<a class="headerlink" href="#experiment-17-lunchbox-hellosoftwarepwm-large-delay" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id83">
<h2>Description<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for generating PWM signal with help of delay using C commands (Software PWM). In this code, intensity of onboard LED on Lunchbox is controlled with Software PWM.</p>
</div>
<div class="section" id="id84">
<h2>Hardware needed<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id85">
<h2>Connections<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id86">
<h2>Output<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id87">
<h2>Code<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define RED   BIT7                          </span><span class="c1">// Red LED -&gt; P1.7</span>

<span class="cm">/**</span>
<span class="cm"> *@brief  This function provides delay</span>
<span class="cm"> *@param  unsigned int</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>                  <span class="c1">// Custom delay function</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                 <span class="c1">// __delay_cycles accepts only constants !</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>               <span class="c1">// Stop watchdog timer</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>                           <span class="c1">// Set LED pin -&gt; Output</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>        <span class="c1">// Increasing Intensity</span>
            <span class="p">{</span>
                <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>               <span class="c1">// LED ON</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="n">delay</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>        <span class="c1">// Delay for ON Time</span>
                <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RED</span><span class="p">;</span>              <span class="c1">// LED OFF</span>
                <span class="k">if</span> <span class="p">((</span><span class="mi">255</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="n">delay</span><span class="p">(</span><span class="mi">255</span><span class="o">-</span><span class="n">j</span><span class="p">);</span>     <span class="c1">// OFF Time = Period - ON Time</span>
            <span class="p">}</span>
            <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">--</span><span class="p">)</span>        <span class="c1">// Decreasing Intensity</span>
            <span class="p">{</span>
                <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>               <span class="c1">// LED ON</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="n">delay</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>        <span class="c1">// Delay for ON Time</span>
                <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RED</span><span class="p">;</span>              <span class="c1">// LED OFF</span>
                <span class="k">if</span> <span class="p">((</span><span class="mi">255</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">delay</span><span class="p">(</span><span class="mi">255</span><span class="o">-</span><span class="n">j</span><span class="p">);</span> <span class="c1">// OFF Time = Period - ON Time</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-18-lunchbox-hello-hardware-pwm-8bit">
<h3>Experiment 18 - LunchBox Hello Hardware PWM (8Bit)<a class="headerlink" href="#experiment-18-lunchbox-hello-hardware-pwm-8bit" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id88">
<h2>Description<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for using Hardware PWM on LunchBox. In this example code, internal 16 bit Timer is used for generating PWM signal of fixed duty cycle. Pin 1.6 of LunchBox is used for getting PWM output.</p>
</div>
<div class="section" id="id89">
<h2>Hardware needed<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h2>
<p>Breadboard, Connecting wires, LED, Resistor (1 kohm).</p>
</div>
<div class="section" id="id90">
<h2>Connections<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of Lunchbox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground.</p>
</div>
<div class="section" id="id91">
<h2>Output<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id92">
<h2>Code<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define GREEN   BIT6                        </span><span class="c1">// Green LED -&gt; P1.6</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t enabling TIMER0 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_TIMER0</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">GREEN</span><span class="p">;</span>                         <span class="c1">// Green LED -&gt; Output</span>
    <span class="n">P1SEL</span> <span class="o">|=</span> <span class="n">GREEN</span><span class="p">;</span>                         <span class="c1">// Green LED -&gt; Select Timer Output</span>

    <span class="n">CCR0</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>                             <span class="c1">// Set Timer0 PWM Period</span>
    <span class="n">CCTL1</span> <span class="o">=</span> <span class="n">OUTMOD_7</span><span class="p">;</span>                       <span class="c1">// Set TA0.1 Waveform Mode - Clear on Compare, Set on Overflow</span>
    <span class="n">CCR1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                               <span class="c1">// Set TA0.1 PWM duty cycle</span>
    <span class="n">CCTL0</span> <span class="o">=</span> <span class="n">CCIE</span><span class="p">;</span>                           <span class="c1">// CCR0 Enable Interrupt</span>
    <span class="n">TACTL</span> <span class="o">=</span> <span class="n">TASSEL_2</span> <span class="o">+</span> <span class="n">MC_1</span><span class="p">;</span>                <span class="c1">// Timer Clock -&gt; SMCLK, Mode -&gt; Up Count</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * Entry point for the code</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>               <span class="c1">// Stop watchdog timer</span>

    <span class="n">register_settings_for_TIMER0</span><span class="p">();</span>

    <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">GIE</span><span class="p">);</span>                 <span class="c1">// Enable CPU Interrupt</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * Entry point for TIMER0_interrupt vector</span>
<span class="cm"> **/</span>
<span class="cp">#pragma vector = TIMER0_A0_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Timer_A</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CCR1</span> <span class="o">=</span> <span class="n">CCR1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>                        <span class="c1">// Increment CCR1</span>
    <span class="k">if</span><span class="p">(</span><span class="n">CCR1</span> <span class="o">==</span> <span class="mi">256</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">CCR1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-19-lunchbox-hello-hardware-pwm-16-bit">
<h3>Experiment 19 - LunchBox Hello Hardware PWM (16 bit)<a class="headerlink" href="#experiment-19-lunchbox-hello-hardware-pwm-16-bit" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id93">
<h2>Description<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for using Hardware PWM on LunchBox. In this example code, internal 16 bit Timer is used for generating PWM signal of fixed duty cycle. Pin 1.6 of LunchBox is used for getting PWM output.</p>
</div>
<div class="section" id="id94">
<h2>Hardware needed<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h2>
<p>Breadboard, Connecting wires, LED, Resistor (1 kohm).</p>
</div>
<div class="section" id="id95">
<h2>Connections<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of Lunchbox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground.</p>
</div>
<div class="section" id="id96">
<h2>Output<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id97">
<h2>Code<a class="headerlink" href="#id97" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt; </span><span class="cp"></span>

<span class="cp">#define GREEN   BIT6                        </span><span class="c1">// Green LED -&gt; P1.6</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t enabling TIMER0 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_TIMER0</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">GREEN</span><span class="p">;</span>                         <span class="c1">// Green LED -&gt; Output</span>
    <span class="n">P1SEL</span> <span class="o">|=</span> <span class="n">GREEN</span><span class="p">;</span>                         <span class="c1">// Green LED -&gt; Select Timer Output</span>

    <span class="n">CCR0</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>                             <span class="c1">// Set Timer0 PWM Period</span>
    <span class="n">CCTL1</span> <span class="o">=</span> <span class="n">OUTMOD_7</span><span class="p">;</span>                       <span class="c1">// Set TA0.1 Waveform Mode - Clear on Compare, Set on Overflow</span>
    <span class="n">CCR1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                               <span class="c1">// Set TA0.1 PWM duty cycle</span>
    <span class="n">CCTL0</span> <span class="o">=</span> <span class="n">CCIE</span><span class="p">;</span>                           <span class="c1">// CCR0 Enable Interrupt</span>
    <span class="n">TACTL</span> <span class="o">=</span> <span class="n">TASSEL_2</span> <span class="o">+</span> <span class="n">MC_1</span><span class="p">;</span>                <span class="c1">// Timer Clock -&gt; SMCLK, Mode -&gt; Up Count</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * Entry point for the code</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">|</span> <span class="n">WDTHOLD</span><span class="p">;</span>               <span class="c1">// Stop watchdog timer</span>
    <span class="n">BCSCTL1</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BIT0</span> <span class="o">+</span> <span class="n">BIT1</span> <span class="o">+</span> <span class="n">BIT2</span> <span class="o">+</span> <span class="n">BIT3</span><span class="p">);</span> <span class="c1">// Selecting RSELx as 15</span>
    <span class="n">DCOCTL</span>  <span class="o">|=</span> <span class="p">(</span><span class="n">BIT6</span> <span class="o">+</span> <span class="n">BIT5</span> <span class="o">+</span> <span class="n">BIT4</span><span class="p">);</span>        <span class="c1">// Selecting DCOx as 7, DCO_freq = 15.6 MHz, Room Temp. ~ 25 deg. Celsius, Operating voltage 3.3 V</span>

    <span class="n">register_settings_for_TIMER0</span><span class="p">();</span>

    <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">GIE</span><span class="p">);</span>                 <span class="c1">// Enable CPU Interrupt</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * Entry point for TIMER0_interrupt vector</span>
<span class="cm"> **/</span>
<span class="cp">#pragma vector = TIMER0_A0_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Timer_A</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CCR1</span> <span class="o">=</span> <span class="n">CCR1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>                        <span class="c1">// Increment CCR1</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-20-lunchbox-hello-adc">
<h3>Experiment 20 - LunchBox Hello ADC<a class="headerlink" href="#experiment-20-lunchbox-hello-adc" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id98">
<h2>Description<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for reading analog data. This code converts the analog value provided by potentiometer into a corresponding 10 bit digital value. The converted digital value is then used to change the brightness of an external LED using PWM.</p>
</div>
<div class="section" id="id99">
<h2>Hardware needed<a class="headerlink" href="#id99" title="Permalink to this headline">¶</a></h2>
<p>Potentiometer (100 k), Resistor (330 ohms), LED, Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id100">
<h2>Connections<a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of LunchBox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground. Pin 1.0 of LunchBox is connected to Analog pin (middle pin) of potentiometer and the other two ends are connected to Vcc and Ground respectively.</p>
</div>
<div class="section" id="id101">
<h2>Output<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id102">
<h2>Code<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>

<span class="cp">#define GREEN   BIT6</span>
<span class="cp">#define AIN     BIT0</span>

<span class="cm">/**</span>
<span class="cm"> *@brief This function maps input range to the required range</span>
<span class="cm"> *@param long Input value to be mapped</span>
<span class="cm"> *@param long Input value range, minimum value</span>
<span class="cm"> *@param long Input value range, maximum value</span>
<span class="cm"> *@param long Output value range, minimum value</span>
<span class="cm"> *@param long Output value range, maximum value</span>
<span class="cm"> *@return Mapped output value</span>
<span class="cm"> **/</span>
<span class="kt">long</span> <span class="nf">map</span><span class="p">(</span><span class="kt">long</span> <span class="n">x</span><span class="p">,</span> <span class="kt">long</span> <span class="n">in_min</span><span class="p">,</span> <span class="kt">long</span> <span class="n">in_max</span><span class="p">,</span> <span class="kt">long</span> <span class="n">out_min</span><span class="p">,</span> <span class="kt">long</span> <span class="n">out_max</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">in_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">out_max</span> <span class="o">-</span> <span class="n">out_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">in_max</span> <span class="o">-</span> <span class="n">in_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">out_min</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling ADC10 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_ADC10</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ADC10AE0</span> <span class="o">|=</span> <span class="n">AIN</span><span class="p">;</span>                            <span class="c1">// P1.0 ADC option select</span>
    <span class="n">ADC10CTL1</span> <span class="o">=</span> <span class="n">INCH_0</span><span class="p">;</span>                         <span class="c1">// ADC Channel -&gt; 1 (P1.0)</span>
    <span class="n">ADC10CTL0</span> <span class="o">=</span> <span class="n">SREF_0</span> <span class="o">+</span> <span class="n">ADC10SHT_3</span> <span class="o">+</span> <span class="n">ADC10ON</span><span class="p">;</span>  <span class="c1">// Ref -&gt; Vcc, 64 CLK S&amp;H</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling TIMER0 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_TIMER0</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">GREEN</span><span class="p">;</span>                             <span class="c1">// Green LED -&gt; Output</span>
    <span class="n">P1SEL</span> <span class="o">|=</span> <span class="n">GREEN</span><span class="p">;</span>                             <span class="c1">// Green LED -&gt; Select Timer Output</span>

    <span class="n">CCR0</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>                                 <span class="c1">// Set Timer0 PWM Period</span>
    <span class="n">CCTL1</span> <span class="o">=</span> <span class="n">OUTMOD_7</span><span class="p">;</span>                           <span class="c1">// Set TA0.1 Waveform Mode</span>
    <span class="n">CCR1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                                   <span class="c1">// Set TA0.1 PWM duty cycle</span>
    <span class="n">TACTL</span> <span class="o">=</span> <span class="n">TASSEL_2</span> <span class="o">+</span> <span class="n">MC_1</span><span class="p">;</span>                    <span class="c1">// Timer Clock -&gt; SMCLK, Mode -&gt; Up Count</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>                   <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">register_settings_for_ADC10</span><span class="p">();</span>

    <span class="n">register_settings_for_TIMER0</span><span class="p">();</span>


    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ADC10CTL0</span> <span class="o">|=</span> <span class="n">ENC</span> <span class="o">+</span> <span class="n">ADC10SC</span><span class="p">;</span>             <span class="c1">// Sampling and conversion start</span>

        <span class="k">while</span><span class="p">(</span><span class="n">ADC10CTL1</span> <span class="o">&amp;</span> <span class="n">ADC10BUSY</span><span class="p">);</span>           <span class="c1">// Wait for conversion to end</span>

        <span class="n">CCR1</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">ADC10MEM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-21-lunchbox-hello-adc-lcd">
<h3>Experiment 21 - LunchBox Hello ADC LCD<a class="headerlink" href="#experiment-21-lunchbox-hello-adc-lcd" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id103">
<h2>Description<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for reading analog data. This code converts the analog value provided by potentiometer into a corresponding 10 bit digital value. The converted digital value is then used to change the brightness of an external LED using PWM.</p>
</div>
<div class="section" id="id104">
<h2>Hardware needed<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h2>
<p>Potentiometer (100 k), Resistor (330 ohms), LED, Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id105">
<h2>Connections<a class="headerlink" href="#id105" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of LunchBox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground. Pin 1.0 of LunchBox is connected to Analog pin (middle pin) of potentiometer and the other two ends are connected to Vcc and Ground respectively.</p>
</div>
<div class="section" id="id106">
<h2>Output<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id107">
<h2>Code<a class="headerlink" href="#id107" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cp">#define CMD         0</span>
<span class="cp">#define DATA        1</span>

<span class="cp">#define AIN         BIT0        </span><span class="c1">// Channel A0</span>

<span class="cp">#define LCD_OUT     P1OUT</span>
<span class="cp">#define LCD_DIR     P1DIR</span>
<span class="cp">#define D4          BIT4</span>
<span class="cp">#define D5          BIT5</span>
<span class="cp">#define D6          BIT6</span>
<span class="cp">#define D7          BIT7</span>
<span class="cp">#define RS          BIT2</span>
<span class="cp">#define EN          BIT3</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Delay function for producing delay in 0.1 ms increments</span>
<span class="cm"> *@param t milliseconds to be delayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to pulse EN pin after data is written</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">pulseEN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to write data/command to LCD</span>
<span class="cm"> *@param value Value to be written to LED</span>
<span class="cm"> *@param mode Mode -&gt; Command or Data</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_write</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CMD</span><span class="p">)</span>
        <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RS</span><span class="p">;</span>             <span class="c1">// Set RS -&gt; LOW for Command mode</span>
    <span class="k">else</span>
        <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">RS</span><span class="p">;</span>              <span class="c1">// Set RS -&gt; HIGH for Data mode</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>              <span class="c1">// Write high nibble first</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>       <span class="c1">// Write low nibble next</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to print a string on LCD</span>
<span class="cm"> *@param *s pointer to the character to be written.</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_print</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lcd_write</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to move cursor to desired position on LCD</span>
<span class="cm"> *@param row Row Cursor of the LCD</span>
<span class="cm"> *@param col Column Cursor of the LCD</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_setCursor</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">row</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">row_offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">};</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row_offsets</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">CMD</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to change numeric value into it&#39;s corresponding char array</span>
<span class="cm"> *@param num Number which has to be displayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_printNumber</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>                        <span class="c1">// Creating a array of size 3</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>                <span class="c1">// Initializing pointer to end of the array</span>

    <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>                        <span class="c1">// storing null pointer at end of string</span>

    <span class="k">do</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">m</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>          <span class="c1">// Storing number in variable m</span>
        <span class="n">num</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>                      <span class="c1">// Dividing number by 10</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>  <span class="c1">// Finding least place value and adding it to get character value of digit</span>
        <span class="o">*--</span><span class="n">str</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>                     <span class="c1">// Decrementing pointer value and storing character at that character</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>

    <span class="n">lcd_print</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Initialize LCD</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LCD_DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>                     <span class="c1">// Wait for power up ( 15ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 1</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                      <span class="c1">// Wait ( 4.1 ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x32</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 2</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                       <span class="c1">// Wait ( 100 us )</span>

    <span class="c1">// All subsequent commands take 40 us to execute, except clear &amp; cursor return (1.64 ms)</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// 4 bit mode, 2 line</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x0C</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Display ON, Cursor OFF, Blink OFF</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Clear screen</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Auto Increment Cursor</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// Goto Row 1 Column 1</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling ADC10 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_ADC10</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ADC10AE0</span> <span class="o">|=</span> <span class="n">AIN</span><span class="p">;</span>                            <span class="c1">// P1.0 ADC option select</span>
    <span class="n">ADC10CTL1</span> <span class="o">=</span> <span class="n">INCH_0</span><span class="p">;</span>                         <span class="c1">// ADC Channel -&gt; 1 (P1.0)</span>
    <span class="n">ADC10CTL0</span> <span class="o">=</span> <span class="n">SREF_0</span> <span class="o">+</span> <span class="n">ADC10SHT_3</span> <span class="o">+</span> <span class="n">ADC10ON</span><span class="p">;</span>  <span class="c1">// Ref -&gt; Vcc, 64 CLK S&amp;H , ADC - ON</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>                       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">lcd_init</span><span class="p">();</span>                                     <span class="c1">// Initializing LCD</span>

    <span class="n">register_settings_for_ADC10</span><span class="p">();</span>


    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ADC10CTL0</span> <span class="o">|=</span> <span class="n">ENC</span> <span class="o">+</span> <span class="n">ADC10SC</span><span class="p">;</span>             <span class="c1">// Sampling and conversion start</span>

        <span class="k">while</span><span class="p">(</span><span class="n">ADC10CTL1</span> <span class="o">&amp;</span> <span class="n">ADC10BUSY</span><span class="p">);</span>           <span class="c1">// Wait for conversion to end</span>


        <span class="kt">float</span> <span class="n">adc_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="n">adc_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">ADC10MEM</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.30</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1023.00</span><span class="p">);</span>    <span class="c1">// mapping 10-bit conversion result of ADC to corresponding voltage</span>

        <span class="kt">int</span> <span class="n">int_part</span> <span class="o">=</span> <span class="n">adc_value</span><span class="p">;</span>                                   <span class="c1">// Integer part of calculated ADC value</span>
        <span class="kt">int</span> <span class="n">decimal_part</span> <span class="o">=</span> <span class="p">(</span><span class="n">adc_value</span> <span class="o">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">int_part</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="p">;</span>  <span class="c1">// Decimal part of calculated ADC value</span>

        <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>                   <span class="c1">// Clear screen</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Pot Reading&quot;</span><span class="p">);</span>

        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
        <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">int_part</span><span class="p">);</span>              <span class="c1">// Displaying integer part of ADC value</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
        <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">decimal_part</span><span class="p">);</span>          <span class="c1">// Displaying decimal part of ADC value</span>
        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;V&quot;</span><span class="p">);</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">6000</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-22-lunchbox-hello-adc-internal-temperature-sensor">
<h3>Experiment 22 - LunchBox Hello ADC Internal Temperature Sensor<a class="headerlink" href="#experiment-22-lunchbox-hello-adc-internal-temperature-sensor" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id108">
<h2>Description<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for reading analog data. This code converts the analog value provided by potentiometer into a corresponding 10 bit digital value. The converted digital value is then used to change the brightness of an external LED using PWM.</p>
</div>
<div class="section" id="id109">
<h2>Hardware needed<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h2>
<p>Potentiometer (100 k), Resistor (330 ohms), LED, Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id110">
<h2>Connections<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of LunchBox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground. Pin 1.0 of LunchBox is connected to Analog pin (middle pin) of potentiometer and the other two ends are connected to Vcc and Ground respectively.</p>
</div>
<div class="section" id="id111">
<h2>Output<a class="headerlink" href="#id111" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id112">
<h2>Code<a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cp">#define CMD         0</span>
<span class="cp">#define DATA        1</span>

<span class="cp">#define LCD_OUT     P1OUT</span>
<span class="cp">#define LCD_DIR     P1DIR</span>
<span class="cp">#define D4          BIT4</span>
<span class="cp">#define D5          BIT5</span>
<span class="cp">#define D6          BIT6</span>
<span class="cp">#define D7          BIT7</span>
<span class="cp">#define RS          BIT2</span>
<span class="cp">#define EN          BIT3</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Delay function for producing delay in 0.1 ms increments</span>
<span class="cm"> *@param t milliseconds to be delayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to pulse EN pin after data is written</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">pulseEN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to write data/command to LCD</span>
<span class="cm"> *@param value Value to be written to LED</span>
<span class="cm"> *@param mode Mode -&gt; Command or Data</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_write</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CMD</span><span class="p">)</span>
        <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RS</span><span class="p">;</span>             <span class="c1">// Set RS -&gt; LOW for Command mode</span>
    <span class="k">else</span>
        <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">RS</span><span class="p">;</span>              <span class="c1">// Set RS -&gt; HIGH for Data mode</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>              <span class="c1">// Write high nibble first</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>       <span class="c1">// Write low nibble next</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to print a string on LCD</span>
<span class="cm"> *@param *s pointer to the character to be written.</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_print</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lcd_write</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to move cursor to desired position on LCD</span>
<span class="cm"> *@param row Row Cursor of the LCD</span>
<span class="cm"> *@param col Column Cursor of the LCD</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_setCursor</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">row</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">row_offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">};</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row_offsets</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">CMD</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to change numeric value into it&#39;s corresponding char array</span>
<span class="cm"> *@param num Number which has to be displayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_printNumber</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>                        <span class="c1">// Creating a array of size 3</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>                <span class="c1">// Initializing pointer to end of the array</span>

    <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>                        <span class="c1">// storing null pointer at end of string</span>

    <span class="k">do</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">m</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>          <span class="c1">// Storing number in variable m</span>
        <span class="n">num</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>                      <span class="c1">// Dividing number by 10</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>  <span class="c1">// Finding least place value and adding it to get character value of digit</span>
        <span class="o">*--</span><span class="n">str</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>                     <span class="c1">// Decrementing pointer value and storing character at that character</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>

    <span class="n">lcd_print</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Initialize LCD</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LCD_DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>                     <span class="c1">// Wait for power up ( 15ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 1</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                      <span class="c1">// Wait ( 4.1 ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x32</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 2</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                       <span class="c1">// Wait ( 100 us )</span>

    <span class="c1">// All subsequent commands take 40 us to execute, except clear &amp; cursor return (1.64 ms)</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// 4 bit mode, 2 line</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x0C</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Display ON, Cursor OFF, Blink OFF</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Clear screen</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Auto Increment Cursor</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// Goto Row 1 Column 1</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief This function maps input range to the required range</span>
<span class="cm"> *@param long Input value to be mapped</span>
<span class="cm"> *@param long Input value range, minimum value</span>
<span class="cm"> *@param long Input value range, maximum value</span>
<span class="cm"> *@param long Output value range, minimum value</span>
<span class="cm"> *@param long Output value range, maximum value</span>
<span class="cm"> *@return Mapped output value</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_ADC10</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ADC10CTL1</span> <span class="o">=</span> <span class="n">INCH_10</span> <span class="o">+</span> <span class="n">ADC10SSEL_3</span><span class="p">;</span>                         <span class="c1">// ADC Channel -&gt; 10 (Internal Temperature Sensor), SMCLK</span>
    <span class="n">ADC10CTL0</span> <span class="o">=</span> <span class="n">SREF_1</span> <span class="o">+</span> <span class="n">ADC10SHT_3</span> <span class="o">+</span> <span class="n">ADC10ON</span> <span class="o">+</span> <span class="n">REFON</span><span class="p">;</span>         <span class="c1">// Ref -&gt; Vref+ (1.5V) , 64 CLK S&amp;H, ADC-ON, Reference generator-ON</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>                       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">lcd_init</span><span class="p">();</span>

    <span class="n">register_settings_for_ADC10</span><span class="p">();</span>


    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="n">ADC10CTL0</span> <span class="o">|=</span> <span class="n">ENC</span> <span class="o">+</span> <span class="n">ADC10SC</span><span class="p">;</span>             <span class="c1">// Sampling and conversion start</span>
        <span class="c1">//lcd_display();</span>
        <span class="k">while</span><span class="p">(</span><span class="n">ADC10CTL1</span> <span class="o">&amp;</span> <span class="n">ADC10BUSY</span><span class="p">);</span>           <span class="c1">// Wait for conversion to end</span>

        <span class="kt">float</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">Int_Deg_C</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">ADC10MEM</span><span class="p">;</span>                                            <span class="c1">// Storing 10-bit conversion result of ADC in variable temp</span>

        <span class="n">Int_Deg_C</span> <span class="o">=</span> <span class="p">((</span><span class="n">temp</span><span class="o">-</span><span class="mi">673</span><span class="p">)</span><span class="o">*</span><span class="mi">423</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1023</span><span class="p">;</span>                        <span class="c1">// Formula to find internal temperature in Celsius</span>

        <span class="kt">int</span> <span class="n">int_part</span> <span class="o">=</span> <span class="n">Int_Deg_C</span><span class="p">;</span>                                   <span class="c1">// Integer part of calculated temperature value</span>
        <span class="kt">int</span> <span class="n">decimal_part</span> <span class="o">=</span> <span class="p">(</span><span class="n">Int_Deg_C</span> <span class="o">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">int_part</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="p">;</span>   <span class="c1">// Decimal part of calculated temperature value</span>

        <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>                       <span class="c1">// Clear screen</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Internal Temp&quot;</span><span class="p">);</span>
        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
        <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">int_part</span><span class="p">);</span>                  <span class="c1">// Displaying integer part of temperature</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
        <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">decimal_part</span><span class="p">);</span>              <span class="c1">// Displaying decimal part of temperature</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot; deg C&quot;</span><span class="p">);</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">6000</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-23-lunchbox-hello-lfsr-8bit">
<h3>Experiment 23 - LunchBox Hello LFSR 8Bit<a class="headerlink" href="#experiment-23-lunchbox-hello-lfsr-8bit" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id113">
<h2>Description<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for reading analog data. This code converts the analog value provided by potentiometer into a corresponding 10 bit digital value. The converted digital value is then used to change the brightness of an external LED using PWM.</p>
</div>
<div class="section" id="id114">
<h2>Hardware needed<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h2>
<p>Potentiometer (100 k), Resistor (330 ohms), LED, Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id115">
<h2>Connections<a class="headerlink" href="#id115" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of LunchBox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground. Pin 1.0 of LunchBox is connected to Analog pin (middle pin) of potentiometer and the other two ends are connected to Vcc and Ground respectively.</p>
</div>
<div class="section" id="id116">
<h2>Output<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id117">
<h2>Code<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>

<span class="cp">#define SW  BIT3                    </span><span class="c1">// Switch -&gt; P1.3 (On-board Switch, Pull-Up configuration)</span>

<span class="cp">#define CMD         0</span>
<span class="cp">#define DATA        1</span>

<span class="cp">#define AIN         BIT0        </span><span class="c1">// Channel A0</span>

<span class="cp">#define LCD_OUT     P1OUT</span>
<span class="cp">#define LCD_DIR     P1DIR</span>
<span class="cp">#define D4          BIT4</span>
<span class="cp">#define D5          BIT5</span>
<span class="cp">#define D6          BIT6</span>
<span class="cp">#define D7          BIT7</span>
<span class="cp">#define RS          BIT1</span>
<span class="cp">#define EN          BIT2</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Delay function for producing delay in 0.1 ms increments</span>
<span class="cm"> *@param t milliseconds to be delayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to pulse EN pin after data is written</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">pulseEN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">EN</span><span class="p">;</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to write data/command to LCD</span>
<span class="cm"> *@param value Value to be written to LED</span>
<span class="cm"> *@param mode Mode -&gt; Command or Data</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_write</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CMD</span><span class="p">)</span>
        <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RS</span><span class="p">;</span>             <span class="c1">// Set RS -&gt; LOW for Command mode</span>
    <span class="k">else</span>
        <span class="n">LCD_OUT</span> <span class="o">|=</span> <span class="n">RS</span><span class="p">;</span>              <span class="c1">// Set RS -&gt; HIGH for Data mode</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>              <span class="c1">// Write high nibble first</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">LCD_OUT</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCD_OUT</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">));</span>       <span class="c1">// Write low nibble next</span>
    <span class="n">pulseEN</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to print a string on LCD</span>
<span class="cm"> *@param *s pointer to the character to be written.</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_print</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lcd_write</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">DATA</span><span class="p">);</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to move cursor to desired position on LCD</span>
<span class="cm"> *@param row Row Cursor of the LCD</span>
<span class="cm"> *@param col Column Cursor of the LCD</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_setCursor</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">row</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">row_offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">};</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="n">row_offsets</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">CMD</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Function to change numeric value into it&#39;s corresponding char array</span>
<span class="cm"> *@param num Number which has to be displayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_printNumber</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>                        <span class="c1">// Creating a array of size 4</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>                <span class="c1">// Initializing pointer to end of the array</span>

    <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>                        <span class="c1">// storing null pointer at end of string</span>

    <span class="k">do</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">m</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>          <span class="c1">// Storing number in variable m</span>
        <span class="n">num</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>                      <span class="c1">// Dividing number by 10</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>  <span class="c1">// Finding least place value and adding it to get character value of digit</span>
        <span class="o">*--</span><span class="n">str</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>                     <span class="c1">// Decrementing pointer value and storing character at that character</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>

    <span class="n">lcd_print</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Initialize LCD</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">lcd_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LCD_DIR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>
    <span class="n">LCD_OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">D4</span><span class="o">+</span><span class="n">D5</span><span class="o">+</span><span class="n">D6</span><span class="o">+</span><span class="n">D7</span><span class="o">+</span><span class="n">RS</span><span class="o">+</span><span class="n">EN</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>                     <span class="c1">// Wait for power up ( 15ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 1</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                      <span class="c1">// Wait ( 4.1 ms )</span>
    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x32</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Initialization Sequence 2</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                       <span class="c1">// Wait ( 100 us )</span>

    <span class="c1">// All subsequent commands take 40 us to execute, except clear &amp; cursor return (1.64 ms)</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// 4 bit mode, 2 line</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x0C</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Display ON, Cursor OFF, Blink OFF</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Clear screen</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>           <span class="c1">// Auto Increment Cursor</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// Goto Row 1 Column 1</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling ADC10 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_ADC10</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ADC10AE0</span> <span class="o">|=</span> <span class="n">AIN</span><span class="p">;</span>                            <span class="c1">// P1.0 ADC option select</span>
    <span class="n">ADC10CTL1</span> <span class="o">=</span> <span class="n">INCH_0</span><span class="p">;</span>                         <span class="c1">// ADC Channel -&gt; 1 (P1.0)</span>
    <span class="n">ADC10CTL0</span> <span class="o">=</span> <span class="n">SREF_0</span> <span class="o">+</span> <span class="n">ADC10SHT_3</span> <span class="o">+</span> <span class="n">ADC10ON</span><span class="p">;</span>  <span class="c1">// Ref -&gt; Vcc, 64 CLK S&amp;H , ADC - ON</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>                       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW</span><span class="p">;</span>                   <span class="c1">// Set SW pin -&gt; Input</span>

    <span class="n">lcd_init</span><span class="p">();</span>                                     <span class="c1">// Initializing LCD</span>

    <span class="n">register_settings_for_ADC10</span><span class="p">();</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ADC10CTL0</span> <span class="o">|=</span> <span class="n">ENC</span> <span class="o">+</span> <span class="n">ADC10SC</span><span class="p">;</span>             <span class="c1">// Sampling and conversion start</span>

        <span class="k">while</span><span class="p">(</span><span class="n">ADC10CTL1</span> <span class="o">&amp;</span> <span class="n">ADC10BUSY</span><span class="p">);</span>           <span class="c1">// Wait for conversion to end</span>

        <span class="kt">uint8_t</span> <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">ADC10MEM</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>   <span class="c1">// Lower 8-bits of ADC conversion result as seed</span>
        <span class="kt">uint8_t</span> <span class="n">lfsr</span> <span class="o">=</span> <span class="n">seed</span><span class="p">;</span>
        <span class="kt">uint8_t</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>              <span class="c1">// Clear screen</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Seed Value :&quot;</span><span class="p">);</span>
        <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>             <span class="c1">// Printing Seed Value</span>

        <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
        <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Press Switch&quot;</span><span class="p">);</span>

        <span class="k">while</span><span class="p">(</span><span class="n">count</span><span class="o">&lt;=</span><span class="mi">255</span><span class="p">)</span>                   <span class="c1">// Changing Seed Value after reading 255 LFSR values</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">))</span>               <span class="c1">// If SW is Pressed</span>
            <span class="p">{</span>
                <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>     <span class="c1">// Wait 20ms to debounce</span>
                <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">P1IN</span> <span class="o">&amp;</span> <span class="n">SW</span><span class="p">));</span>       <span class="c1">// Wait till SW Released</span>
                <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>     <span class="c1">// Wait 20ms to debounce</span>

                <span class="kt">uint8_t</span> <span class="n">bit</span><span class="p">;</span>
                <span class="n">bit</span> <span class="o">=</span> <span class="p">((</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">));</span>     <span class="c1">// Taking taps</span>
                <span class="n">lfsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bit</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>                                   <span class="c1">// Shifting LFSR</span>

                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

                <span class="n">lcd_write</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">CMD</span><span class="p">);</span>      <span class="c1">// Clear screen</span>
                <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

                <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;Seed Value :&quot;</span><span class="p">);</span>
                <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>      <span class="c1">// Printing Seed Value</span>

                <span class="n">lcd_setCursor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">lcd_print</span><span class="p">(</span><span class="s">&quot;LFSR Value :&quot;</span><span class="p">);</span>
                <span class="n">lcd_printNumber</span><span class="p">(</span><span class="n">lfsr</span><span class="p">);</span>      <span class="c1">// Printing LFSR Value</span>
                <span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-24-lunchbox-hello-lfsr-32bit">
<h3>Experiment 24 - LunchBox Hello LFSR 32Bit<a class="headerlink" href="#experiment-24-lunchbox-hello-lfsr-32bit" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id118">
<h2>Description<a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for reading analog data. This code converts the analog value provided by potentiometer into a corresponding 10 bit digital value. The converted digital value is then used to change the brightness of an external LED using PWM.</p>
</div>
<div class="section" id="id119">
<h2>Hardware needed<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h2>
<p>Potentiometer (100 k), Resistor (330 ohms), LED, Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id120">
<h2>Connections<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of LunchBox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground. Pin 1.0 of LunchBox is connected to Analog pin (middle pin) of potentiometer and the other two ends are connected to Vcc and Ground respectively.</p>
</div>
<div class="section" id="id121">
<h2>Output<a class="headerlink" href="#id121" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id122">
<h2>Code<a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cp">#define RED  BIT7                    </span><span class="c1">// Switch -&gt; P1.3 (On-board Switch, Pull-Up configuration)</span>
<span class="cp">#define AIN         BIT0        </span><span class="c1">// Channel A0</span>

<span class="cm">/**</span>
<span class="cm"> *@brief Delay function for producing delay in 0.1 ms increments</span>
<span class="cm"> *@param t milliseconds to be delayed</span>
<span class="cm"> *@return void</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">delay</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling ADC10 on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_ADC10</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ADC10AE0</span> <span class="o">|=</span> <span class="n">AIN</span><span class="p">;</span>                            <span class="c1">// P1.0 ADC option select</span>
    <span class="n">ADC10CTL1</span> <span class="o">=</span> <span class="n">INCH_0</span><span class="p">;</span>                         <span class="c1">// ADC Channel -&gt; 1 (P1.0)</span>
    <span class="n">ADC10CTL0</span> <span class="o">=</span> <span class="n">SREF_0</span> <span class="o">+</span> <span class="n">ADC10SHT_3</span> <span class="o">+</span> <span class="n">ADC10ON</span><span class="p">;</span>  <span class="c1">// Ref -&gt; Vcc, 64 CLK S&amp;H , ADC - ON</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>                       <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">RED</span><span class="p">;</span>            <span class="c1">// P1.7 (Red LED)</span>

    <span class="n">register_settings_for_ADC10</span><span class="p">();</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ADC10CTL0</span> <span class="o">|=</span> <span class="n">ENC</span> <span class="o">+</span> <span class="n">ADC10SC</span><span class="p">;</span>             <span class="c1">// Sampling and conversion start</span>

        <span class="k">while</span><span class="p">(</span><span class="n">ADC10CTL1</span> <span class="o">&amp;</span> <span class="n">ADC10BUSY</span><span class="p">);</span>           <span class="c1">// Wait for conversion to end</span>

        <span class="kt">uint32_t</span> <span class="n">lfsr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">lfsr</span> <span class="o">|=</span> <span class="n">ADC10MEM</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">while</span><span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">uint32_t</span> <span class="n">bit</span><span class="p">;</span>
            <span class="n">bit</span> <span class="o">=</span> <span class="p">((</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">));</span>     <span class="c1">// Taking taps</span>
            <span class="n">lfsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bit</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">);</span>                                   <span class="c1">// Shifting LFSR</span>

            <span class="n">P1OUT</span> <span class="o">=</span> <span class="p">(</span><span class="n">lfsr</span> <span class="o">&amp;</span> <span class="mh">0x00000001</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">7</span><span class="p">;</span>  <span class="p">;</span>      <span class="c1">// Setting RED LED according to one bit of 32*bit LFSR</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-25-lunchbox-hello-dac">
<h3>Experiment 25 - LunchBox Hello DAC<a class="headerlink" href="#experiment-25-lunchbox-hello-dac" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id123">
<h2>Description<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for reading analog data. This code converts the analog value provided by potentiometer into a corresponding 10 bit digital value. The converted digital value is then used to change the brightness of an external LED using PWM.</p>
</div>
<div class="section" id="id124">
<h2>Hardware needed<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h2>
<p>Potentiometer (100 k), Resistor (330 ohms), LED, Breadboard, Connecting wires.</p>
</div>
<div class="section" id="id125">
<h2>Connections<a class="headerlink" href="#id125" title="Permalink to this headline">¶</a></h2>
<p>Pin 1.6 of LunchBox is connected to anode of LED through a resistor of 1 kohm and cathode to Ground. Pin 1.0 of LunchBox is connected to Analog pin (middle pin) of potentiometer and the other two ends are connected to Vcc and Ground respectively.</p>
</div>
<div class="section" id="id126">
<h2>Output<a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id127">
<h2>Code<a class="headerlink" href="#id127" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp"></span>

<span class="kt">char</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t enabling GPIO on LunchBox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_GPIO</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="mh">0xFF</span><span class="p">;</span>                                <span class="c1">//P1.0 to P1.7 are set as Output</span>
    <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">);</span>                             <span class="c1">//Initially they are set to logic zero</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>                 <span class="c1">//! Stop Watch dog (Not recommended for code in production and devices working in field)</span>

  <span class="n">register_settings_for_GPIO</span><span class="p">();</span>

  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">P1OUT</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>                        <span class="c1">// Assign value of Count to PORT 1 to represent it as binary number</span>
      <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>
      <span class="n">count</span> <span class="o">++</span><span class="p">;</span>                             <span class="c1">// Increment count</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-26-lunchbox-lemon-battery-led-blink">
<h3>Experiment 26  LunchBox Lemon Battery LED Blink<a class="headerlink" href="#experiment-26-lunchbox-lemon-battery-led-blink" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id128">
<h2>Description<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for enabling serial communication with UART on LunchBox. Baud Rate for UART communication is set to 9600.</p>
</div>
<div class="section" id="id129">
<h2>Hardware needed<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="id130">
<h2>Connections<a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h2>
<p>For using UART, Jumper J1 and J2 needs to be changed from Programming mode to UART mode.</p>
</div>
<div class="section" id="id131">
<h2>Output<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id132">
<h2>Code<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>
<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling GPIO on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_GPIO</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1DIR</span> <span class="o">|=</span> <span class="n">BIT7</span><span class="p">;</span>                            <span class="c1">// P1.7 as Output</span>
    <span class="n">P1OUT</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BIT7</span><span class="p">;</span>                           <span class="c1">// Initialize with zero</span>
<span class="p">}</span>
<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are w.r.t enabling TIMER0 on Lunch Box</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_TIMER0</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">CCTL0</span> <span class="o">=</span> <span class="n">CCIE</span><span class="p">;</span>                         <span class="c1">// CCR0 interrupt enabled</span>
    <span class="n">TACTL</span> <span class="o">=</span> <span class="n">TASSEL_1</span> <span class="o">+</span> <span class="n">MC_1</span><span class="p">;</span>              <span class="c1">// ACLK = 32768 Hz, Up mode</span>
    <span class="n">CCR0</span> <span class="o">=</span>  <span class="mi">32768</span><span class="p">;</span>                        <span class="c1">// 1 Hz</span>
<span class="p">}</span>
<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>             <span class="c1">//! Stop Watch dog (Not recommended for code in production and devices working in field)</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">do</span><span class="p">{</span>
         <span class="n">IFG1</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">OFIFG</span><span class="p">;</span>                    <span class="c1">// Clear oscillator fault flag</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span>           <span class="c1">// Delay</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">IFG1</span> <span class="o">&amp;</span> <span class="n">OFIFG</span><span class="p">);</span>                 <span class="c1">// Test osc fault flag</span>

  <span class="n">register_settings_for_TIMER0</span><span class="p">();</span>
  <span class="n">register_settings_for_GPIO</span><span class="p">();</span>
  <span class="n">_BIS_SR</span><span class="p">(</span><span class="n">LPM3_bits</span> <span class="o">+</span> <span class="n">GIE</span><span class="p">);</span>                <span class="c1">// Enter LPM3 w/ interrupt</span>
<span class="p">}</span>
<span class="cm">/*@brief entry point for TIMER0 interrupt vector*/</span>
<span class="cp">#pragma vector= TIMER0_A0_VECTOR</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">Timer_A</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">P1OUT</span> <span class="o">|=</span> <span class="n">BIT7</span><span class="p">;</span>                      <span class="c1">//  LED HIGH</span>
    <span class="n">__delay_cycles</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="n">P1OUT</span> <span class="o">&amp;=~</span> <span class="n">BIT7</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="experiment-27-lunchbox-hello-serial">
<h3>Experiment 27 - LunchBox Hello Serial<a class="headerlink" href="#experiment-27-lunchbox-hello-serial" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id133">
<h2>Description<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h2>
<p>This example code provides function and register settings for enabling serial communication with UART on LunchBox. Baud Rate for UART communication is set to 9600. It utilises on board CH340, which acts as USB-to-UART bridge. While recieving UART data, J1 and J2  selection should be on side 2.</p>
</div>
<div class="section" id="id134">
<h2>Course link<a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h2>
<p>Covered in lecture number - Lecture 33</p>
</div>
<div class="section" id="id135">
<h2>Hardware needed<a class="headerlink" href="#id135" title="Permalink to this headline">¶</a></h2>
<p>NA</p>
</div>
<div class="section" id="id136">
<h2>Schematic image<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h2>
<p>NA</p>
</div>
<div class="section" id="id137">
<h2>Connections<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h2>
<p>For using UART, Jumper J1 and J2 needs to be changed from Programming mode to UART mode.</p>
</div>
<div class="section" id="id138">
<h2>Output<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h2>
<p>An incremented character will be recieved on putty (or any serial terminal) wrt whatever you will send.</p>
</div>
<div class="section" id="id139">
<h2>Code<a class="headerlink" href="#id139" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;msp430.h&gt;</span><span class="cp"></span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * These settings are wrt enabling uart on Lunchbox</span>
<span class="cm"> **/</span>
<span class="kt">void</span> <span class="nf">register_settings_for_UART</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">P1SEL</span> <span class="o">=</span> <span class="n">BIT1</span> <span class="o">+</span> <span class="n">BIT2</span><span class="p">;</span>              <span class="c1">// Select UART RX/TX function on P1.1,P1.2</span>
    <span class="n">P1SEL2</span> <span class="o">=</span> <span class="n">BIT1</span> <span class="o">+</span> <span class="n">BIT2</span><span class="p">;</span>

    <span class="n">UCA0CTL1</span> <span class="o">|=</span> <span class="n">UCSSEL_1</span><span class="p">;</span>               <span class="c1">// UART Clock -&gt; ACLK</span>
    <span class="n">UCA0BR0</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>                        <span class="c1">// Baud Rate Setting for 32kHz 9600</span>
    <span class="n">UCA0BR1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                        <span class="c1">// Baud Rate Setting for 32kHz 9600</span>
    <span class="n">UCA0MCTL</span> <span class="o">=</span> <span class="n">UCBRF_0</span> <span class="o">+</span> <span class="n">UCBRS_3</span><span class="p">;</span>       <span class="c1">// Modulation Setting for 32kHz 9600</span>
    <span class="n">UCA0CTL1</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UCSWRST</span><span class="p">;</span>               <span class="c1">// Initialize UART Module</span>
    <span class="n">IE2</span> <span class="o">|=</span> <span class="n">UCA0RXIE</span><span class="p">;</span>                    <span class="c1">// Enable RX interrupt</span>
<span class="p">}</span>

<span class="cm">/*@brief entry point for the code*/</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">WDTCTL</span> <span class="o">=</span> <span class="n">WDTPW</span> <span class="o">+</span> <span class="n">WDTHOLD</span><span class="p">;</span>           <span class="c1">//! Stop Watchdog (Not recommended for code in production and devices working in field)</span>

    <span class="n">register_settings_for_UART</span><span class="p">();</span>

    <span class="n">__bis_SR_register</span><span class="p">(</span><span class="n">LPM0_bits</span> <span class="o">+</span> <span class="n">GIE</span><span class="p">);</span> <span class="c1">// Enter LPM0, Enable Interrupt</span>

<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief</span>
<span class="cm"> * Interrupt Vector for UART on LunchBox</span>
<span class="cm"> **/</span>
<span class="cp">#pragma vector=USCIAB0RX_VECTOR         </span><span class="c1">// UART RX Interrupt Vector</span>
<span class="n">__interrupt</span> <span class="kt">void</span> <span class="nf">USCI0RX_ISR</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">IFG2</span><span class="o">&amp;</span><span class="n">UCA0TXIFG</span><span class="p">));</span>          <span class="c1">// Check if TX is ongoing</span>
    <span class="n">UCA0TXBUF</span> <span class="o">=</span> <span class="n">UCA0RXBUF</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>          <span class="c1">// TX -&gt; Received Char + 1</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../Get_Started/index.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Sincgrid LLP

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>